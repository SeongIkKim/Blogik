---
title: AWS Certified Developer Associate - S3
date: 2020-12-17
draft: False
tags: [Udemy, AWS, AWS Certified Developer Associate, S3]
excerpt: Ultimate AWS Certified Developer Associate 2020 by Stephane Maarek
---

# S3

`Bucket`에 `Object`(파일)를 보관하는 서비스

Bucket은 region 종속적이지만, <U>globally unique name</U>을 가져야 한다.  
Bucket의 naming convention은 다음과 같다.

- 대문자를 사용하지 않음
- 언더스코어(\_)를 사용하지 않음
- 3-63자 길이
- IP가 아니어야 함
- 소문자나 숫자로 시작해야함

## Object(files)

Object는 Key를 가지고 있으며, Key는 버킷 내에서 **해당 파일의 FULL PATH**를 의미한다.

예를 들어, my-bucket이라는 이름의 Bucket내부에 my_file.txt가 있다고 하면, 해당 파일의 경로는 다음과 같이 표시할 수 있다.

- `S3://my-bucket/my_folder1/another_folder/my_file.txt`
- 이 때, my-bucket/ 이하의 full path를 Key라고 일컫는다.
- Key는 prefix와 object name으로 이루어져있다. 따라서 위의 경로에서..
  - Key : `my_folder1/another_folder/my_file.txt`
  - prefix : `my_folder1/another_folder/`
  - object_name : 'my_file.txt'

### Object 구성

- `value` : body의 내용물
  - 단일 Object의 최대 저장 가능 사이즈는 5TB(5000GB)
  - 만약 단일 PUT의 용량이 5GB를 넘어가면, **multi-part upload**를 사용해야한다.
    - Multi-part Upload는 5MB부터 5TB의 경우까지 사용할 수 있다.
  - 버킷 자체에는 용량 제한이 없다(infinity)
- `meta-data` : 시스템이나 유저 정보에 관한 키값 쌍 리스트
- `tags` : 최대 10개까지 저장할 수 있는 유니코드 키값 쌍. 보안이나 라이프사이클에 유용하다.
- 'version ID' : 버져닝이 활성화되어있을 경우에 존재한다

## Versioning

Bucket 레벨에서 Versioning 옵션을 활성화 할 수 있다.  
Versioning 옵션이 켜져 있을 경우, 동일한 파일을 저장할 때 그대로 덮어씌워지는 것이 아니라 1,2,3 씩 변경사항을 적용시킨 버전을 모두 보관해둔다.

버킷 Versioning을 설정 해놓는 것이 best practice.

- 의도치 않게 삭제하는 것을 방지할 수 있다(버전 복구 기능을 이용하면 된다)
- 이전 버전으로 롤백이 쉽다.

<Info>
  Versioning을 켜기 이전, 버전이 존재하지 않는 파일들은 'null' 버전이 표시된다.
  또한, Versioning을 비활성화하여도 이전에 저장된 버전들은 사라지지 않는다.
</Info>

## Object 암호화

S3의 Object를 암호화하는 방식은 총 4가지가 있다.

1. **SSE-S3** : AWS에 의해 관리/핸들링 되는 키(S3 Managed Data Key)를 사용해 암호화하기
2. **SSE-KMS** : 암호화 키 관리에 `AWS Key Management Service` 이용하기
3. **SSE-C** : 직접 암호화 키를 관리하고 싶을 때
4. Client Side Encryption

상황에 맞추어 네 가지 방식을 적절히 사용하는 것이 중요하다.

### SSE-S3

암호화에 S3 Managed Data Key를 이용한다.

- 서버 사이드 암호화
- AES-256 암호화 알고리즘 사용
- HTTP 헤더에 `"x-amz-server-side-encryption" : "AES256"`을 붙여야 한다.

### SSE-KMS

암호화에 KMS의 키를 이용한다.

- 다른 계정의 KMS master key를 사용할 수도 있다(ARN을 입력하면 된다)
- 장점 : 키 유저를 컨트롤할 수 있고, 감사 추적(audit trail)이 가능하다.
  - 감사 추적이란, 리소스 사용에 따라 기록된 사용 내역을 의미한다.
- 서버사이드 암호화
- HTTP 헤더에 `"x-amz-server-side-encryption" : "aws:kms"`을 붙여야 한다.

### SSE-C

AWS 외부의 Customer가 관리하는 데이터 키를 이용한다.

- 서버사이드 암호화
- S3는 Customer가 제공하는 키를 저장하지 않는다(저장하면 보안사고..)
- 통신 중 키가 탈취되지 않도록 보안에 유의해야 하므로 **반드시 HTTPS를 사용**한다.
- 암호화 키가 매 HTTP요청마다 헤더에 붙어야한다.

### Client Side Encryption

Customer가 직접 `Amazon S3 Encryption Client`같은 클라이언트 암호화 라이브러리를 이용한다.

- S3에 파일을 올리기 전에 암호화 해야한다.
- S3에서 파일을 내려받은 이후 복호화 해야한다.
- Customer가 키와 암호화 사이클을 완전히 관리한다.
- HTTP/HTTPS를 모두 사용할 수 있다(이미 암호화 된 파일이므로)

## 전송 암호화(SSL/TLS)

S3는 다음과 같은 엔드포인트 선택지를 제공한다.

- HTTP endpoint : 암호화되지 않음, public
- HTTPS endpoint : 전송 중 암호화 처리 --> Encrpytion in flight은 SSL/TLS라고도 불린다.

둘 중 어느것을 사용해도 되지만, HTTPS 엔드포인트를 사용하는것이 권장된다.  
대부분의 클라이언트들은 HTTPS 엔드포인트를 디폴트로 사용하고 있다.
또한, SSE-C에서는 HTTPS 엔드포인트만을 사용할 수 있다.
