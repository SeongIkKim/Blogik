---
title: AWS Certified Developer Associate - 기초
date: 2020-12-08
tags:
  [
    Udemy,
    AWS,
    AWS Certified Developer Associate,
    IAM,
    EC2,
    ENI,
    Security Groups,
  ]
excerpt: Ultimate AWS Certified Developer Associate 2020 - Udemy 강의 정리
---

# Budgets

AWS 서비스 사용 금액 제한, 알림 설정 등이 가능하다.

# Availiablity Zones

각 Region마다 최소 2개, 최대 6개, 평균 3개 정도 존재한다.  
각 AZ는 redundant power, networking, connectivity를 가진 데이터센터들이 하나 이상 존재한다.  
AZ들 간은 분리되어 있으면서도 높은 대역폭, 아주 낮은 지연도의 네트워킹으로 연결되어 있기때문에, 자연재해 등의 위협으로부터 안전하다.

---

# IAM

- `Users` - per physical person
- `Groups` - contain users
- `Roles` - per AWS resourece(Application)

Regional Service가 아닌 Global Service이다.
Permission은 JSON으로 작성된 Policies에 의해 관리된다.

규모가 큰 기업의 경우 IAM user들을 모아서 own repositiory를 관리하는데, 이 경우 company credential로 AWS에 로그인할 수 있다.
SAML standard를 사용한다고 한다.

---

- 가상 머신(컴퓨터) 대여 - `EC2`
- 가상 드라이브에 데이터 스토리징 - `EBS`
- 머신간의 로드 분산 - `ELB`
- auto-scaling group을 이용하여 service scaling - `ASG`

---

# EC2

### 과금

최소 60초로 시작해서, 초 단위로 과금.  
스토리지, 데이터 전송량, 고정 IP 사용, 로드 밸런싱 등의 요인에 따라 추가 과금.

## AMI

Linux 또는 Windows machine으로 own AMI를 만들어 인스턴스 base로 사용할 수 있으며, 기본적으로 제공하는 AMI도 많다.
단, (cusmtom) AMI는 region 종속적이다.

## Instance Lanch Types

**5 distinct characteristics of Instances**

- RAM (type, amount, generation)
- CPU (type, make, frequency, generation, numbers of cores)
- I/O (disk performance, EBS optimisations)
- Network (network bandwidth, network latency)
- Graphical Processing Unit (GPU)

`R/C/P/G/H/X/I/F/Z/CR` 등은 RAM, CPU, I/O, Network, GPU 등에 특화된 인스턴스를 말한다.
`M`은 Balanced type, `T2,T3`는 Burstable type.
Burstable type은 예상치못한 traffic에도 대응할 수 있지만, load가 길어지면 효율이 떨어진다.  
만약 안정적인 traffic이 예상되는 인스턴스가 있다면, burstable 이외의 다른 타입을 사용하는 것이 낫다.

### On Demand

- short workload, predictable pricing
  - pay for what you use
  - 가장 높은 비용, 후불제
  - 단기간, application이 어떻게 동작할 지 모르는 un-interrupted workload에 사용

### Reserved

- On demand에 비해 cheap(최대 75% 할인), 1년 혹은 3년간 대여해야함
- 약정기간에 대한 선불제, 특정 인스턴스 타입 사용
- steady state usage application에 사용(database를 사용하는 경우처럼)

- Reserved : long workload
- Convertible Reserved : long workloads, 그러나 인스턴스 타입 변경 가능, 54%까지 할인
- Scheduled Reserved : 예약해둔 시간대에만 런칭 - day, week, month 주기로 사용할 때

### Spot

- short workload, cheap(최대 90% 할인), 그러나 유실 위험(less reliable) if your max pirce is less than current spot price
- 가장 비용효율적인 서비스
- failure에도 회복성이 있는 workload에 사용(DB나 중요한 서비스에는 사용X)
  - Batch jobs
  - Data analysis
  - Image processing
  - 이외에도 실패하면 그냥 다시 시도하면 되는 workload들

### Dedicated

- Dedicated Instances : 다른 사용자와 하드웨어를 공유하지 않는 타입

  - 해당 사용자에게 할당되므로, 같은 계정의 다른 인스턴스와는 하드웨어 공유 가능
  - 인스턴스 위치에 대해서는 컨트롤 불가(Stop/Start 이후에만 가능)

- Dedicated Hosts : 물리 서버를 전적으로 예약해서, 인스턴스 위치까지 지정하는 타입
  - 내부 소켓, 하드웨어 코어까지 확인 가능
  - EC2 인스턴스 자체에 대한 Full control
  - 3년간 계약
  - 비쌈
  - complicated licensing model을 가지고 있는 software에 적합 (BYOL - Bring Your Own License)
  - 또는 strong regulatory 또는 compliance needs의 기업들에게 적합

### 이상적인 조합

**Base : Reserved Instance**
**peaks : On-Demand & Spot**

## SSH(Secure SHell)

Mac, Linux, Windows 10이상에서 지원하는 프로토콜(또는 해당 프로토콜을 사용하는 유틸리티 자체)  
원격지에 있는 컴퓨터 접속시 사용

## Security Group

EC2 인스턴스의 Firewall 역할. 인스턴스 외부에 존재한다.  
여러 인스턴스에 매칭 될수 있으며, region, VPC 제한을 걸수도 있다.  
디폴트로 모든 inbound traffic이 block되어있으며, 모든 outbound traffic은 반대로 authorized 되어있다.

<Info>SSH 액세스를 위한 Security Group을 하나만 만들어 놓는것이 좋다.</Info>
<Info>
  Application 접속시 "time out" 에러가 뜬다면, Security Group 이슈이다. 그러나
  "connection refuesd" 에러가 뜬다면 application의 문제이거나, 인스턴스 런칭이
  안된 것이다.
</Info>

## Private/Public IP(IPv4)

- `Public IP`
  - Internet(WWW)에서 사용되는 machine 식별자
  - Whole Web에서 unique해야함
  - IP를 통해 machine 위치를 특정할 수 있음
- `Private IP`
  - Private network 내에서 machine을 구분하는 식별자
  - 사설망 내부에서만 unique함
  - Internet Gateway(proxy)를 통해 WWW에 machine을 연결할 수 있다
  - 특정 IP 범위만 Private IP로 사용됨
- `Elastic IP`
  - EC2 인스턴스는 restart할 때마다 Public IP가 바뀌는데, 이를 고정해두기 위해 Elastic IP를 할당받아 사용
  - Public IPv4 IP로, 계정당 최대 5개까지만 할당 가능하다.
  - Elastic IP를 이용해서, 한 인스턴스나 소프트웨어가 오동작할 시 계정 내의 다른 인스턴스로 즉시 address를 remapping할 수 있음.
  - 그렇지만 아키텍쳐 구성에 문제가 되는 경우가 많기 때문에, EIP보다는 차라리 **randome public ip를 사용하고 DNS name을 붙이는 것을 추천**
  - 또는, **public IP를 아예 사용하지 않고 Load Balancer를 사용**하는 것이 Best Practice라고 알려져있다.

## User Data

EC2 인스턴스에 bootstrapping script를 추가하여, 최초 실행시에 단 한번만 실행하도록 설정할 수 있다.
해당 script는 root user가 수행하므로, sudo 권한을 가진다.  
일반적으로 업데이트 설치, 소프트웨어 설치, 인터넷에서 파일 다운로드 등을 위해 사용된다.

## Elastic Network Interfaces(ENI)

`VPC`의 logical component. Virtual Network Card를 의미한다.
EC2 외부에 있으며, 특정 Availiablity Zone(AZ)에 종속적이다.
EC2가 네트워크에 접속할 수 있도록 해주는 역할을 한다.
다음과 같은 특성을 가진다.

- Primary private IPv4, one or more secondary IPv4
- One Elastic IP (IPv4) per private IPv4
- One Public IPv4
- One or more security groups
- A MAC Address

EC2 인스턴스와 독립적으로도 생성가능하며, EC2 인스턴스에 붙일수 있다(for failover).
이처럼 쉽게 attach/detach 할 수 있는 특성 덕에 IP Address들과 Security 그룹을 묶어서 적용하고 관리하기에 용이하다.

---

**Vertical Scalability : instance의 사이즈를 upgrade**

- DB처럼 non-distributed system에서 일반적
- `RDS`, `ElastiCache` 등의 scaling 방식
- Hardware limit(상한)이 있다
- `scale up/down`이라고 말함

**Horizantal Scalability : application을 serving하는 instance/system의 갯수를 upgrade**

- distributed system이라는 것을 함축한다
- modern (web) application에서 가장 흔한 방식
- `Auto Scaling Group`, `Load Balancer` 등의 scaling 방식
- `EC2` 같은 클라우드 서비스의 이점
- `scale in/out`이라고 말함

**High Availiablity : 여러 개의 data center(AZ)에서 같은 application의 instance를 돌리는 형태**

- 일반적으로 horizantal scaling과 함께 사용됨
- 데이터 센터 유실에도 문제없이 서비스
- `Auto Scaling Group multi AZ`, `Load Balancer multi AZ` 등의 방식
- passive : ex) `RDS` multi AZ
- active : ex) horizantal scaling

---

# ELB(EC2 Load Balancer)

## 개요

### Load Balancer란?

인터넷 트래픽을 다수의 (EC2) 서버에 분산시켜 흘려보내는 서버

### Load Balancer를 사용하는 이유

- multiple downstream instance에 load를 분산시켜 흩뿌려준다
- application에 Single Access Point(DNS)를 만들 수 있다
- downstream instances의 failure를 매끈하게(Seamlessly) 핸들링할 수 있다
- 인스턴스의 정기적인 상태 체크가 가능하다
- SSL termination(HTTPS)를 제공한다
- 쿠키의 stickiness를 강제한다
- High Availiablity across Zones
- public traffic과 private traffic을 분리할 수 있다

### 왜 ELB를 사용해야 하는가?

- AWS 공식 managed load balancer이기 때문에
  - 작동이 보장되고, AWS에서 upgrade, maintenance, high availability, configuration knobs를 지원한다.
- 직접 load balancer를 운용하는것보다 훨씬 싸다(...)
- 비용이 조금 더 들지만, 그냥 own load balancer를 운용하는 것보다 노력이 절감된다.
- 다양한 AWS 리소스와 궁합이 잘 맞다

### Good to Know

**Troubleshooting**

- 4xx error : client측 에러
- 5xx error : application측 에러
- 503 error : capacity가 부족하거나, registered target이 없다는 말
- LB와 application이 연결되지 않으면 security group을 체크할 것

**Monitoring**

- ELB access log에 모든 access request가 저장됨(따라서 request별로 debug할 수 있음)
- CloudWatch Metrics에서 aggregate statistics 확인 가능(ex: connections count)

<Info>
  LB는 즉각적인 Scaling이 힘들다. 만약 필요하다면 AWS에 "warm-up"을 요청하도록
  하자.
</Info>

## Health Checks

- crucial for LB
- forward traffic에 대한 response를 적절히 전달해 줄 수 있는지 LB가 인스턴스를 체크하는 개념
- port와 route를 이용하여 진행된다(`/health` 명령어)

## Types

일반적으로 Application Load Balancer(v2)를 사용하는 것 권장.  
Internal(private) / External(public) ELB도 설정할 수 있음.

### 1.Classic Load Balancer(v1 - old generation) - 2009

- HTTP&HTTPS(Layer 7), TCP(Layer 4)

### 2.Application Load Balancer(v2 - new generation) - 2016

- HTTP, HTTPS, WebSocket(전부 Layer 7)
- target group 내의 machine들 간의 HTTP application 로드밸런싱
  - URL내의 path, hostname에 따라 / Query String, Headers에 따라 Routing
- 단일 machine 내에서도 multiple application을 로드밸런싱 (ex - containers)
- HTTP/2와 WebSocket을 지원
- redirect 기능 지원(ex - HTTP to HTTPS)
- micro services & container-based application에 적합 (ex - `Docker` & `Amazon ECS`)
- `ECS`의 dynamic port로 redirecting해주는 port mapping 기능 지원
- 기존의 CLB는 애플리케이션 당 하나가 필요했지만, ALB는 한 대로 여러 애플리케이션을 다룰 수 있다.

**Good to Know**

- Fixed hostname(XXX.region.elb.amazonaws.com)
- applicaiton server는 client의 IP를 directly하게 볼 수 없고, LB의 IP(private)만 보게 된다.
  - 클라이언트의 진짜 IP는 header X-Forwarded-For에 삽입된다.
  - Port(X-Forwarded-Port)와 Proto(X-Forwarded-Proto)에서도 확인할 수 있다.

ALB를 생성하고 난 뒤, Listener 탭에 들어가 rule을 정하여 target group에 routing / redirecting 등을 할 수 있다.

<Info>
  Target Group : Auto Scaling Group에 의해 managing되는 EC2 Instances / ECS
  tasks / Lambda Functions / IP Addresses(private) 등의 묶음. ALB는 여러개의
  target group에 route할 수 있고, Health Check도 target group 단위로 수행됨.
</Info>

### 3. Network Load Balancer(v2 - new generation) - 2017

- TCP, TLS (secure TCP) & UDP (전부 Layer 4)
  - Forwad TCP & UDP traffic만 허용
  - 초당 수 백만개의 request 처리
  - latency ~100ms(vs 400 ms for ALB)
  - 따라서 extreme performance를 위해 사용된다
- **AZ당 1개의 static IP**를 지원, `Elastic IP` 할당 지원(특정 IP whitelisting에 유용)
- AWS free tier에 포함되어 있지 않음

## Stickiness

CLB의 경우 Load Balancer attribute에서, ALB의 경우 Target Group attribute에서 선택

- 같은 client가 Load Balancer를 거칠 때 항상 동일한 instance로 연결되도록 할 수 있다.
- Client가 session data를 잃지 않고 접속하도록 하기 위해 Stickiness를 확보한다.
- cookie를 사용하여야 하며, cookie는 expiration date를 가진다.
- Stickiness를 허용할 경우 EC2 instance 로드량의 불균형해지기도 한다.
- CLB와 ALB만 존재.

## Cross-Zone Load Balancing(옵션)

Load Balancing 시 로드가 모든 AZ에 있는 Instances로 균일하게 분산된다.  
이 옵션을 켜놓지 않으면 Load Balacer와 같은 AZ안에 있는 Instances에 대해서만 Load Balancing 수행.

- CLB
  - default : 비활성화
  - 활성화 하더라도 inter AZ 간의 data 이동 시 과금 X
- ALB
  - default : 활성화(비활성화 불가)
  - inter AZ 간의 data 이동 시 과금 X
- NLB
  - default : 비활성화
  - 활성화하면 inter AZ 간의 data 이동 시 과금

## SSL/TLS - Basics

`SSL` : Secure Sockets Layer, 연결을 암호화하는 데에 사용됨  
`TLS` : Transport Layer Security, SSL보다 신식

요새는 대부분 TLS 인증서를 사용하지만, 아직도 SSL이라고 부른다.

Public SSL은 Certificate Authorities(CA)에 의해 발행된다.  
또한, 만료기한을 (직접) 정해야하기 때문에, 갱신해 줄 필요가 있다.

Load Balancer는 X.509 Certificate를 사용하며, 인증서들은 `ACM(AWS Certificate Mangaer)`에서 관리할 수 있다.
물론, 가지고 있는 인증서를 직접 올릴수도 있다.

**HTTPS Listener**

- default 인증서를 선택해야 한다.
- 여러 도메인을 지원하기 위해 인증서를 선택적으로 추가할 수도 있다.
- **Client는 도달하는 hostname을 specify하기위해 SNI(Server Name Indication)를 사용한다.**
- 구 버전의 SSL/TLS(legacy clients) 지원을 위해 security policy를 specify할 수 있음

## Server Name Indication(SNI)

한 웹 서버 내에 여러 개의 websites를 serving하기 위해서 여러 개의 SSL 인증서를 로드해야하는 문제를 해결해준다.

Newer 프로토콜이며, client는 최초의 SSL handshake에서 target server의 hostname을 명시(indicate)해야한다.
그 이후 서버는 알맞은 인증서를 찾아 로드시켜주거나, 또는 default 인증서를 로드한다.

SNI는 ALB와 NLB, `CloudFront`에서만 작동한다. (CLB는 older gen이라 지원하지 않는다)

- CLB
  - 하나의 SSL 인증서만을 지원한다
  - 여러 SSL 인증서를 가진 multiple hostname을 지원하기 위해서는 CLB를 여러 대 만들어야 한다.
- ALB, NLB
  - 여러 개의 SSL 인증서를 위한 muitiple listener를 지원한다.
  - 이를 위해 `SNI`를 사용한다.

# Auto Scaling Group(ASG)

Scaling : 웹사이트와 어플리케이션의 가변적인 로드량에 맞추기 위해 cloud 환경에서 server를 빠르게 만들고 삭제하는 것

- Load가 늘어나면 Scale out, 줄어들면 Scale in
- machine의 최소, 최대 갯수도 설정할 수 있다.
- 자동적으로 load balancer에 instance를 생성해 연결해준다.

### 팁

과금되지 않는 서비스이다. ASG 내부의 리소스들에 대해서만 과금한다.  
ASG의 IAM role은 내부의 instances에게 적용된다.  
ASG를 사용한다는 것은 인스턴스가 모종의 이유로 삭제되더라도 즉시 대체 리소스를 생성한다는 이야기이므로, Extra Safety를 보장한다.  
LB로부터 unhealty 판정을 받은 instances를 삭제하고 재생성할 수 있다.

## Attribute

- Launch Configuration
  - AMI + Instance Type
  - EC2 User Data
  - EBS Volumes
  - Security Groups
  - SSH Key Pair
- 최소 사이즈, 최대 사이즈, 초기 capacity
- Network + Subnets 정보
- Load Balancer 정보
- Scaling Policies

## Auto Scaling Alarms

`CloudWatch` alarm에 따라 ASG의 scaling을 설정할 수 있다.
Alarm은 ASG 인스턴스들 전체의 지표를 주시하고 이를 ASG에 알린다.
ASG는 이에 따라 Scaling(out, in)을 수행한다.

- 효과적인 Auto Scaling rules based on...
  - Target Average CPU Usage
  - Numbers of requests of the ELB per instance
  - Average Network In
  - Average Network Out
  - 설정하기도 쉽고 합리적이다.

Custom Metrics도 사용할 수 있다.  
_EC2의 custom metrics -> CloudWatch(PutMetric API) -> CloudWatch Alarm -> ASG Scaling_

## Scaling Policies

- Target Tracking Scaling
  - 가장 쉽고 간단한 방식
  - ex) average ASG CPU 사용률을 40%로 두고 싶을 때
- Simple / Step Scaling
  - ex) CloudWatch alarm이 작동하면 n개의 unit을 추가한다
  - ex) CloudWatch alarm이 작동하면 unit U를 제거한다
- Scheduled Actions
  - 알고 있는 사용패턴에 맞추어서 예측 scaling
  - ex) 금요일 10시부터 5시까지 최소 용량을 늘릴것

### Scaling Cooldown

- 이전의 scaling 작업이 끝나기 전까지 추가적인 scaling을 하지 않는다 -> 이를 Cooldown이라고 부름
- default cooldown말고도 특정 simple scaling policy에 적용되는 scaling-specific cooldown을 만들 수 있음
- scaling-specific cooldown은 default cooldown period를 override함
- default cooldown은 300초, 만약 더 짧게 하고 싶다면 scaling policy에 scaling-specific cooldown을 180초로 설정하면 됨.
- 너무 많이 scaling한다면 cool-down period와 CloudWatch Alarm 시간을 조정할것
