---
title: Graph 05 - 추천 시스템 기초
date: 2021-02-24
tags: [BoostCamp AI Tech, Graph, Recommender System, Content-based Recommender System, 내용기반 추천시스템, Collaborative Filtering Recommender System, 협업필터링기반 추천시스템]
excerpt: 그래프를 추천시스템에 어떻게 활용할까 by 신기정 교수님, BoostCamp AI Tech 5주차
---
본 정리 내용은 [Naver BoostCamp AI Tech](https://boostcamp.connect.or.kr/)의 edwith에서 학습한 내용을 정리한 것입니다.  
사실과 다른 부분이 있거나, 수정이 필요한 사항은 댓글로 남겨주세요.

---

# 추천시스템

아마존 고객 맞춤 상품 / 넷플릭스 영화 추천 / 유튜브 영상 추천 / 페이스북 친구 추천 등

**`추천 시스템`**은 사용자 각각이 구매/선호할만한 상품을 추천하는 기법이다.

사용자별 구매기록은 그래프로 표현 가능한데, 두가지로 나눌 수 있다.

- 암시적(Implicit) 선호 - ex)구매 기록
- 명시적(Explicit) 선호 - ex)평점

![recommend](./img/graph/recommend.png)

추천 시스템의 핵심은 사용자별 구매를 예측하거나, 선호를 추정하는 것인데, 그래프 관점에서 이를 풀었을 때 **"미래의 간선을 예측하는 문제"**혹은 **"누락된 간선의 가중치(선호)를 추정하는 문제"**로 해석할 수 있다.

## 내용 기반 추천시스템

**`내용 기반 추천시스템`**은 각 사용자가 구매/만족했던 상품과 유사한 것을 추천하는 방식이다.

- 동일한 장르의 영화
- 동일한 감독의 영화 혹은 동일 배우가 출연한 영화
- 동일한 카테고리의 상품
- 동갑의 같은 학교를 졸업한 사람

### 원리

1. 사용자가 선호했던 상품들의 `상품 프로필(Item Profile)`을 수집한다.
    - 상품 프로필이란, 해당 상품의 특성을 나열한 벡터이다.
    - 영화의 경우 감독/장르/배우 등의 **원-핫 인코딩**이 상품 프로필로 사용될 수 있다.
2. 사용자가 선호한 상품 프로필의 선호도를 가중평균하여 `사용자 프로필`을 구성한다.
    - 즉, 사용자 프로필 역시 벡터이다.
3. 사용자 프로필 벡터 $\overrightharpoon{u}$와 (추천할만한 다른) 상품 프로필 벡터 $\overrightharpoon{v}$의 코사인 유사도 $\frac{\overrightharpoon{u}\cdot\overrightharpoon{v}}{\Vert\overrightharpoon{u}\Vert\Vert\overrightharpoon{v}\Vert}$를 계산하여 매칭한다.
    - 즉, 두 벡터의 사이각의 코사인 값을 계산한다.(두 벡터의 내적값 / 두 벡터의 크기의 곱)
        - 두 벡터가 비슷한 방향을 바라보고 있거나, 크기가 비슷할수록 코사인 유사도가 높게 나온다.
    - 코사인 유사도가 높을수록, 해당 사용자가 선호/구매했던 물품들과 비슷한 상품이다.
4. 계산된 코사인 유사도가 가장 높은 상품을 사용자에게 추천한다.

### 장/단점

| 장점                                 | 단점                                                  |
| ------------------------------------ | ----------------------------------------------------- |
| 다른 사용자의 구매기록이 필요없음    | 부가정보가 없는 경우 사용 불가                        |
| 독특한 취향의 사용자에게도 추천 가능 | 구매기록이 없는 사용자에게는 사용 불가                |
| 새 상품에 대한 추천 가능             | Overfitting으로 지나치게 협소한 추천을 할 위험이 있음 |
| 추천의 이유를 제공할 수 있음         |                                                       |



## 협업 필터링 추천 시스템

내용 기반 추천시스템을 일부 보완하는 추천방식이다.

### 원리

**`사용자-사용자 협업 필터링`**이란, 예상 사용자에게 유사한 취향을 가진 다른 사용자들이 사용했던 상품을 추천하는 것이다.

 추천의 대상 사용자를 $x$라고 할 때,

1. $x$와 유사한 취향의 사용자들을 찾는다.
2. 유사한 취향의 사용자들이 선호한 상품을 찾는다.
3. 이 상품들을 $x$에게 추천한다.

이 때 **취향의 유사도**는 **`상관계수(Correlation Coefficient)`**를 통해 측정한다.

$$
sim(x,y) = \frac{\sum_{s\in S_{xy}}(r_{xs}-\overline{r_x})(r_{ys}-\overline{r_y})}{\sqrt{\sum_{s\in S_{xy}}(r_{xs}-\overline{r_x})^2}\sqrt{\sum_{s\in S_{xy}}(r_{ys}-\overline{r_y})^2}}
$$

- $r_{xs}$ : 사용자 $x$가 상품 $s$에 대해 매긴 평점
- $\overline{r_x}$ : 사용자 $x$가 매긴 평균 평점
- $S_{xy}$ : 사용자 $x$와 $y$가 공동 구매한 상품들
- 분모는 유사도 값을 -1과 1사이로 정규화하는 목적으로 사용한다.

구체적으로는 **취향의 유사도를 가중치로 사용한 평점의 가중 평균**을 통해 평점을 추정한다.

사용자 $x$의 상품 $s$에 대한 평점을 $r_{xs}$로 추정할 때, 상관 계수를 이용하여 상품 $s$를 구매한 사용자 중 $x$와 취향이 유사한 $k$명의 사용자 $N(x;s)$를 뽑는다.

$$
\hat{r}_{xs} = \frac{\sum_{y\in N(x;s)}sim(x,y)\cdot r_{ys}}{\sum_{y\in N(x;s)}sim(x,y)}
$$

- 취향이 유사한 $k$명이라도, 유사한 정도의 차이가 있기 때문에 가중치 $sim(x,y)$를 곱해준다.
- $r_{ys}$ : 유사한 취향의 사람 $y$가 매긴 평점

이 방식을 통해, $x$가 아직 구매하지 않은 상품들에 대해 평점을 각각 추정하고, 추정한 평점이 가장 높은 상품들을 $x$에게 추천한다.

### 장/단점


| 장점                                                | 단점                                                         |
| --------------------------------------------------- | ------------------------------------------------------------ |
| 상품에 대한 부가 정보(속성 정보)가 없어도 사용 가능 | 충분한 수의 평점 데이터가 누적되어야함                       |
|                                                     | 새 상품, 새 사용자에 대한 추천 불가                          |
|                                                     | 독특한 취향의 사용자에게 추천 불가(취향이 유사한 사람을 찾아내기 어려움) |



#

## 추천 시스템 평가

### 데이터 분리

추천시스템의 정확도를 평가하기위해서, **`데이터 분리`** 기법을 사용한다.

데이터를 훈련(Training) 데이터와 평가(Test) 데이터로 분리하고, 훈련 데이터를 이용하여 가려진 평가 데이터의 평점을 추정한다. 이후, 평가 데이터의 추정 평점과 실제 평점을 비교하여 오차를 측정하고 학습한다.

- 이 때 오차 측정 지표로는 **`MSE`**가 많이 사용된다.
- 평가 데이터 내의 평점들의 집합을 T라고 할 때, MSE는 다음과 같이 구할 수 있다.

$$
\frac{1}{|T|}\sum_{r_{xi}\in T}(r_{xi}-\hat{r}_{xi})^2
$$

- MSE에 제곱근을 씌운 **`RMSE`**도 많이 사용된다.

#

### 평가지표

이외에도 다양한 평가지표가 활용된다.

- 추정한 평점으로 순위를 매긴 후, 실제 평점으로 매긴 순위와 상관계수 계산
- 추천한 상품 중 실제 구매로 이루어진 것의 비율 측정
- 추천의 순서 혹은 다양성까지 고려하는 지표들도 사용